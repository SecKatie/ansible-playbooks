---
# Example: Application with HTTPS backend (self-signed certificate)
#
# This example shows how to deploy an application that has an HTTPS backend
# with a self-signed certificate (like Kubernetes Dashboard).
# Uses Traefik IngressRoute with ServersTransport.

- name: Deploy application with HTTPS backend
  hosts: localhost
  connection: local
  gather_facts: false
  
  vars:
    app_name: kubernetes-dashboard
    app_namespace: kubernetes-dashboard
    app_ingress_host: dashboard.corp.mulliken.net
    app_service_name: kubernetes-dashboard-kong-proxy
    app_service_port: 443
    
  tasks:
    # Create namespace
    - name: Create namespace
      include_role:
        name: common_k8s
        tasks_from: namespace
      vars:
        k8s_namespace: "{{ app_namespace }}"
        k8s_labels:
          app.kubernetes.io/name: "{{ app_name }}"
    
    # Deploy application with Helm or manifests
    - name: Deploy application
      # ... your deployment method here ...
    
    # Create IngressRoute with HTTPS backend support
    - name: Create IngressRoute for HTTPS backend
      include_role:
        name: common_k8s
        tasks_from: ingressroute
      vars:
        k8s_namespace: "{{ app_namespace }}"
        k8s_ingressroute_name: "{{ app_name }}"
        k8s_ingressroute_host: "{{ app_ingress_host }}"
        k8s_ingressroute_service_name: "{{ app_service_name }}"
        k8s_ingressroute_service_port: "{{ app_service_port }}"
        k8s_ingressroute_insecure_skip_verify: true
        k8s_labels:
          app.kubernetes.io/name: "{{ app_name }}"

