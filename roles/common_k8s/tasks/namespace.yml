---
# Create a Kubernetes namespace with standard labels
#
# Required variables:
#   - k8s_namespace: Namespace name
#
# Optional variables:
#   - k8s_labels: Additional labels (dict)

- name: Validate required variables for namespace
  ansible.builtin.assert:
    that:
      - k8s_namespace is defined
      - k8s_namespace | length > 0
      - k8s_namespace is string
      - k8s_labels is not defined or k8s_labels is mapping
    fail_msg: |
      Variable validation failed for namespace creation:
      - k8s_namespace: {{ k8s_namespace | default('NOT DEFINED') }}
      
      Required: k8s_namespace (non-empty string)
      Optional: k8s_labels (dictionary)
    success_msg: "Validation passed for namespace: {{ k8s_namespace }}"

- name: Create namespace {{ k8s_namespace }}
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "{{ k8s_namespace }}"
        labels: "{{ {'app.kubernetes.io/managed-by': 'ansible'} | combine(k8s_labels | default({})) }}"

