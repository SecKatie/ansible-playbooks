# Plane Helm values - Generated by Ansible
# See: https://developers.plane.so/self-hosting/methods/kubernetes

planeVersion: {{ plane_version }}

# Global affinity - prefer to avoid scheduling on control-plane nodes
affinity: &default-affinity
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: node-role.kubernetes.io/control-plane
              operator: DoesNotExist

# Standard labels for Homepage dashboard integration
web:
  labels:
    app: plane-web
    app.kubernetes.io/name: plane
    app.kubernetes.io/component: web
  affinity: *default-affinity
{% if plane_web_replicas is defined %}
  replicas: {{ plane_web_replicas }}
{% endif %}

api:
  labels:
    app: plane-api
    app.kubernetes.io/name: plane
    app.kubernetes.io/component: api
  affinity: *default-affinity
{% if plane_api_replicas is defined %}
  replicas: {{ plane_api_replicas }}
{% endif %}
{% if plane_api_memory_limit is defined %}
  memoryLimit: {{ plane_api_memory_limit }}
{% endif %}
{% if plane_api_cpu_limit is defined %}
  cpuLimit: {{ plane_api_cpu_limit }}
{% endif %}

space:
  labels:
    app: plane-space
    app.kubernetes.io/name: plane
    app.kubernetes.io/component: space
  affinity: *default-affinity
{% if plane_space_replicas is defined %}
  replicas: {{ plane_space_replicas }}
{% endif %}

admin:
  labels:
    app: plane-admin
    app.kubernetes.io/name: plane
    app.kubernetes.io/component: admin
  affinity: *default-affinity

live:
  labels:
    app: plane-live
    app.kubernetes.io/name: plane
    app.kubernetes.io/component: live
  affinity: *default-affinity

worker:
  labels:
    app: plane-worker
    app.kubernetes.io/name: plane
    app.kubernetes.io/component: worker
  affinity: *default-affinity
{% if plane_worker_replicas is defined %}
  replicas: {{ plane_worker_replicas }}
{% endif %}

# Ingress - disabled because we use Traefik IngressRoute
ingress:
  enabled: false
  appHost: {{ plane_domain }}
{% if plane_minio_host %}
  minioHost: {{ plane_minio_host }}
{% endif %}
{% if plane_rabbitmq_host %}
  rabbitmqHost: {{ plane_rabbitmq_host }}
{% endif %}

# PostgreSQL configuration
postgres:
  local_setup: {{ plane_postgres_local_setup | lower }}
  volumeSize: {{ plane_postgres_volume_size }}
  storageClass: {{ plane_storage_class }}

# Redis/Valkey configuration
redis:
  local_setup: {{ plane_redis_local_setup | lower }}
  volumeSize: {{ plane_redis_volume_size }}
  storageClass: {{ plane_storage_class }}

# RabbitMQ configuration
rabbitmq:
  local_setup: {{ plane_rabbitmq_local_setup | lower }}
  volumeSize: {{ plane_rabbitmq_volume_size }}
  storageClass: {{ plane_storage_class }}
  default_user: {{ plane_rabbitmq_username }}
  default_password: {{ plane_rabbitmq_password }}

# Minio (object storage) configuration
minio:
  local_setup: {{ plane_minio_local_setup | lower }}
  volumeSize: {{ plane_minio_volume_size }}
  storageClass: {{ plane_storage_class }}
  root_user: {{ plane_minio_root_user }}
  root_password: {{ plane_minio_root_password }}

# Environment variables
env:
  # Database credentials
  pgdb_username: {{ plane_postgres_username }}
  pgdb_password: {{ plane_postgres_password }}
  pgdb_name: plane

  # Document store
  docstore_bucket: {{ plane_docstore_bucket }}
  doc_upload_size_limit: "{{ plane_doc_upload_size_limit | int }}"

  # Secret key (required)
  secret_key: {{ plane_secret_key }}

# Live server configuration
live_server_secret_key: {{ plane_live_server_secret_key }}

